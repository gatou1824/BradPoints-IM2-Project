<!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Reports & Feedback - Admin</title>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
        <link rel="stylesheet" href="adminStyles.css">
    </head>
    <body> 
                    <div style="display: flex; justify-content: center; margin-top: 20px;">
                        <div class="tab-buttons">
                            <a href="../adminDashboard.html"><button>Home</button></a>
                            <a href="../users.html"><button>Users</button></a>
                            <a href="../feedbacks.html"><button>Feedbacks</button></a>
                            <a href="../rewards.html"><button class="active">Incentives</button></a>
                        </div>
                    </div>

                    <div id="rewardsSection" style="margin-bottom: 5rem;">
                        <div class="d-flex justify-content-between align-items-center mb-6">
                            <h2>Rewards Management</h2>
                            <button class="btn btn-primary custom-red-card" onclick="addReward()">Add Reward</button>
                        </div>

                        <table class="table table-hover">
                            <thead class="thread-red">
                                <tr>
                                    <th>id</th>
                                    <th>Food Name</th>
                                    <th>Reward Name</th>
                                    <th>Points</th>
                                    <th># of Redemptions</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="rewardsTableBody">
                                
                            </tbody>
                        </table>
                    </div> 

                    <div id="foodsSection">
                        <div class="d-flex justify-content-between align-items-center mb-6">
                            <h2>Foods Management</h2>
                            <button class="btn btn-primary custom-red-card" onclick="addFood()">Add Food</button>
                        </div>

                        <table class="table table-hover">
                            <thead class="thread-red">
                                <tr>
                                    <th>id</th>
                                    <th>Food Name</th>
                                    <th>Points</th>
                                    <th>Available</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="foodsTableBody">
                                
                            </tbody>
                        </table>
                    </div> 


        <!-- Modal Divs Below -->
            <!-- add reward modal -->
            </div>
            
            <!-- edit reward modal -->
            <div class="modal fade" id="editRewardModal" tabindex="-1" role="dialog">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Edit Reward</h5>
                        <button type="button" class="close" data-dismiss="modal">
                        <span>&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="editRewardForm">
                        <input type="hidden" id="rewardIdField">
                        <div class="form-group">
                            <label>Reward Name</label>
                            <input type="text" class="form-control" id="editRewardName">
                        </div>
                        <div class="form-group">
                            <label>Points Required</label>
                            <input type="number" class="form-control" id="editRewardPoints">
                        </div>
                        <div class="form-group">
                            <label>Image</label>
                            <input type="file" class="form-control-file">
                        </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        <button class="btn btn-success" id="saveEditBtn">Save Changes</button>
                    </div>
                    </div>
                </div>
            </div>

    </body>

    <script>
        fetch('nav.html')
        .then(res => res.text())
        .then(html => {
            document.getElementById('sidebar').innerHTML = html;
            document.body.style.visibility = 'visible';
        })
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Set up edit button event listeners
            const editButtons = document.querySelectorAll('.edit-btn');
            let activeRow = null; // to remember which row we're editing

            editButtons.forEach(btn => {
            btn.addEventListener('click', function () {
                const row = this.closest('tr');
                activeRow = row;

                const rewardName = row.children[1].textContent.trim();
                const points = row.children[3].textContent.trim();
                const rewardId = row.children[0].textContent.trim();

                document.getElementById('editRewardName').value = rewardName;
                document.getElementById('editRewardPoints').value = points;
                document.getElementById('rewardIdField').value = rewardId;

                $('#editRewardModal').modal('show');
            });
            });

            // Handle Save button
            document.getElementById('saveEditBtn').addEventListener('click', () => {
            if (!activeRow) return;

            const newName = document.getElementById('editRewardName').value.trim();
            const newPoints = document.getElementById('editRewardPoints').value.trim();

            // Update the actual HTML in the row
            activeRow.children[1].textContent = newName;
            activeRow.children[3].textContent = newPoints;

            // Optionally: add a visual flash or toast here

            $('#editRewardModal').modal('hide');
            });
        });

        // delete modal js
        document.addEventListener('DOMContentLoaded', function () {
            const deleteButtons = document.querySelectorAll('.delete-btn');

            deleteButtons.forEach(btn => {
            btn.addEventListener('click', function () {
                const row = this.closest('tr');
                const rewardId = row.children[0].textContent.trim();
                const rewardName = row.children[1].textContent.trim();

                // Set the modal's hidden field and message
                document.getElementById('deleteRewardId').value = rewardId;
                document.getElementById('deleteRewardText').textContent = 
                `Are you sure you want to delete the reward "${rewardName}"?`;

                // Show modal (Bootstrap 4)
                $('#deleteRewardModal').modal('show');
            });
            });

            document.getElementById('confirmDeleteBtn').addEventListener('click', function () {
                const rewardId = document.getElementById('deleteRewardId').value;
                console.log(`Deleting reward with ID: ${rewardId}`);

                // TODO: Add actual delete logic here (fetch backend)
                // For now tangtangon lng ang row sa table:
                const rowToDelete = Array.from(document.querySelectorAll('table tbody tr'))
                    .find(row => row.children[0].textContent.trim() === rewardId);

                if (rowToDelete) rowToDelete.remove();

                // close
                $('#deleteRewardModal').modal('hide');
                });
            });
    </script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

                    
</html>