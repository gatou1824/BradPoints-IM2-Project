<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Auth Test</title>
</head>
<body>
  <h2>Register</h2>
  <form id="registerForm">
    <input type="text" id="regUsername" placeholder="Username" required>
    <input type="text" id="regEmail" placeholder="Email" required />
    <input type="password" id="regPassword" placeholder="Password" required />
    <button type="submit">Register</button>
  </form>
  <p id="registerResult"></p>

  <h2>Login</h2>
  <form id="loginForm">
    <input type="text" id="loginEmail" placeholder="Email" required />
    <input type="password" id="loginPassword" placeholder="Password" required />
    <button type="submit">Login</button>
  </form>
  <p id="loginResult"></p>

  <!-- login -->


  <script>
    const apiBase = 'http://localhost:51540'; // Change if your server uses a different port

    document.getElementById('registerForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const username = document.getElementById('regUsername').value
      const email = document.getElementById('regEmail').value;
      const password = document.getElementById('regPassword').value;

      const res = await fetch(`${apiBase}/auth/register`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({username, email, password })
      });

      const data = await res.json();
      console.log(data)
      document.getElementById('registerResult').textContent = data.token ? `Token: ${data.token}` : 'Registration failed';
    });

    document.getElementById('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;

      const res = await fetch(`${apiBase}/auth/login`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password })
      });

      const data = await res.json();
        if (data.token) {
            localStorage.setItem('token', data.token); // Save the token
            console.log(data.user.role)

            if(data.user.role === 'customer') {
              window.location.href = '/dashboard/customer'
            } else {
              window.location.href = '/dashboard';       // Redirect to dashboard
            }

        } else {
            document.getElementById('loginResult').textContent = data.message || 'Login failed';
        }
    });
  </script>
</body>
</html>
